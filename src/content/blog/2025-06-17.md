---
title: 'Avoid using `searchParams`'
description: 'Avoid using `searchParams` for passing information or storing state'
publishedDate: '2025-06-16'
---

## Introduction

I've been working on a NextJS project, and made a mistake by relying too much on `searchParams` for passing an information or storing a state. While there are circumstances where passing data via `searchParams` is absolutely necessary, choosing this option over available alternatives causes performance disadvantages:

1. NextJS opt-out static rendering for dynamic rendering because the value of `searchParams` can't be known on the build time.
2. If the value of `searchParams` depends on the user input, we cannot prefetch the page efficiently.

## Setting up the example app

In this post, we're going to take a look on an example imlementation of registration flow which consists of two screens:

- sign up -> where user fills the registration form
- email verification -> contains a single OTP input and a text "_verification code has been sent to \<user-email>_"

### Sign up page

```tsx
import React, { useState } from 'react';
import { useRouter } from 'next/navigation';

export function SignUpPage() {
 const [form, setForm] = useState({ email: '', username: '', password: '' });

 const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  setForm({ ...form, [e.target.name]: e.target.value });
 };

 const router = useRouter();

 const handleSubmit = (e: React.FormEvent) => {
  e.preventDefault();
  // TODO: handle sign up logic
  console.log('Sign Up Data:', form);
  router.push(`/email-verification?email=${encodeURIComponent(form.email)}`);
 };

 return (
  <div className="flex min-h-screen items-center justify-center bg-gray-50 px-4">
   <div className="w-full max-w-md space-y-8 rounded-2xl bg-white p-8 shadow-xl">
    <h2 className="text-center text-3xl font-bold text-gray-900">Create an account</h2>
    <form className="space-y-6" onSubmit={handleSubmit}>
     <div className="space-y-4">
      <div>
       <label htmlFor="email" className="block text-sm font-medium text-gray-700">
        Email address
       </label>
       <input
        id="email"
        name="email"
        type="email"
        required
        value={form.email}
        onChange={handleChange}
        className="w-full rounded-lg border px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-500"
       />
      </div>
      <div>
       <label htmlFor="username" className="block text-sm font-medium text-gray-700">
        Username
       </label>
       <input
        id="username"
        name="username"
        type="text"
        required
        value={form.username}
        onChange={handleChange}
        className="w-full rounded-lg border px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-500"
       />
      </div>
      <div>
       <label htmlFor="password" className="block text-sm font-medium text-gray-700">
        Password
       </label>
       <input
        id="password"
        name="password"
        type="password"
        required
        value={form.password}
        onChange={handleChange}
        className="w-full rounded-lg border px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-500"
       />
      </div>
     </div>

     <div>
      <button
       type="submit"
       className="w-full rounded-lg bg-indigo-600 px-4 py-2 font-semibold text-white shadow-sm hover:bg-indigo-700"
      >
       Sign Up
      </button>
     </div>
    </form>
   </div>
  </div>
 );
}
```

### Email verification page

```ts
'use client';

import React, { useState } from 'react';

export function EmailVerificationForm({ userEmail }: { userEmail: string }) {
 const [otp, setOtp] = useState(Array(6).fill(''));

 const handleChange = (index: number, value: string) => {
  if (/^[0-9]?$/.test(value)) {
   const updated = [...otp];
   updated[index] = value;
   setOtp(updated);

   // auto focus next input
   const next = document.getElementById(`otp-${index + 1}`);
   if (value && next) (next as HTMLInputElement).focus();
  }
 };

 const handleSubmit = () => {
  const code = otp.join('');
  // TODO: handle verification logic
  console.log('Submitted OTP:', code);
 };

 return (
  <div className="flex min-h-screen items-center justify-center bg-gray-50 px-4">
   <div className="w-full max-w-md space-y-6 rounded-2xl bg-white p-8 text-center shadow-xl">
    <h2 className="text-2xl font-bold text-gray-900">Verify Your Email</h2>
    <p className="text-gray-600">
     A verification code has been sent to{' '}
     <span className="font-semibold text-gray-900">{userEmail}</span>.
    </p>

    <div className="mt-6 flex justify-center gap-2">
     {otp.map((digit, idx) => (
      <input
       key={idx}
       id={`otp-${idx}`}
       type="text"
       inputMode="numeric"
       maxLength={1}
       value={digit}
       onChange={(e) => handleChange(idx, e.target.value)}
       className="h-12 w-12 rounded-md border text-center text-lg focus:ring-2 focus:ring-indigo-500"
      />
     ))}
    </div>

    <button
     onClick={handleSubmit}
     className="mt-6 w-full rounded-lg bg-indigo-600 px-4 py-2 font-semibold text-white shadow-sm hover:bg-indigo-700"
    >
     Verify
    </button>
   </div>
  </div>
 );
}
```

## Measuring performance

After we submitted the sign-up form, you may notice a slight delay because the `/email-verification` page is renderred on-demand.

It doesn't make much sense that `/email-verification` is renderred on demand, because **almost the entire page will look the same for every user**, it's only the message "A verification code has been sent to {...}" that's personalised for the user. In addition, **the (Next) server doesn't really need to know this value**.

## Refactoring

To solve this issue, we can use a client storage. There are several options, but in this example we're going to use `sessionStorage` because of its simple API.

```tsx
// sign-up/form.tsx
const handleSubmit = (e: React.FormEvent) => {
 e.preventDefault();
 // TODO: handle sign up logic
 console.log('Sign Up Data:', form);
 sessionStorage.setItem('email', form.email);
 router.push('/email-verification');
};
```

```tsx
export default function EmailVerificationPage() {
 return <EmailVerificationForm />;
}
```

Let's try running the sign-up flow again with the network tab opened.

- TODO: insert image or something

As you can see, the waiting time is faster now.

We still can improve the perceived perfromance by prefetching the `/email-verification` route.

> **Good to know**: NextJS prefetches every href on `Link` component when they're visible in the viewport. However, because this scenario redirects the user programmatically, we have to call prefetch manually.

To prefetch the next page programmatically, we can use `router.prefetch` function.

```tsx
useEffect(() => {
 router.prefetch(`/email-verification`);
}, [router]);
```
